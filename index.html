<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plataforma de Enriquecimiento de Datos</title>
    <!-- 1. Cargar Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
     /* Estilo simple para el loader principal */
     /* Oculta el loader si #root tiene contenido (React se cargó) */
     #root:not(:empty) ~ #loader { display: none; }
     /* Muestra el loader si #root está vacío */
     #root:empty + #loader { display: flex; }
     /* Por defecto, el loader está oculto hasta que CSS decida */
     #loader { display: none; }
    </style>
</head>
<body class="bg-gray-100 font-sans">

    <!-- 2. El contenedor donde se dibujará la aplicación React -->
    <div id="root"></div>

    <!-- Loader que se muestra si #root está vacío -->
    <div id="loader" class="flex justify-center items-center h-screen">
        <div class="text-xl font-semibold text-gray-700">Cargando plataforma...</div>
    </div>

    <!-- 3. Cargar React, ReactDOM y Babel -->
    <script src="https://unpkg.com/react@17/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone@7/babel.min.js"></script>

    <!-- 4. Cargar Firebase (versión 9, compatible con la sintaxis global) -->
    <!-- Usamos 'compat' para poder usar la sintaxis global firebase.firestore() -->
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
    
    <!-- 4.1 Cargar Papa Parse (para leer CSV/TSV) -->
    <!-- Es mejor cargarlo aquí directamente que dinámicamente en el script de React -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>


    <!-- 5. Nuestro código React -->
    <script type="text/babel">
        'use strict';

        // --- Mapeo de dependencias a las variables globales ---
        const { useState, useEffect, useMemo, Fragment } = React;
        // Nota: initializeApp y demás se usarán con el prefijo global 'firebase.'

        let db;
        let auth;
        let appId;
        let collectionPath;

        /**
         * Inicializa Firebase y maneja la autenticación.
         */
        const setupFirebase = async (setUserId, setAuthReady, setGlobalError) => {
          try {
            
            // --- USANDO CONFIGURACIÓN GLOBAL DE FIREBASE ---
            // El entorno ya proporciona las variables __firebase_config y __app_id
            
            let firebaseConfig;
            if (typeof __firebase_config !== 'undefined' && __firebase_config !== '{}') {
                firebaseConfig = JSON.parse(__firebase_config);
            } else {
                const errorMsg = "Error: No se encontró la configuración de Firebase del entorno (__firebase_config).";
                console.error(errorMsg);
                document.getElementById('loader').innerHTML = `<div class="p-4 text-center"><div class="text-xl font-semibold text-red-600">${errorMsg}</div></div>`;
                setGlobalError(errorMsg);
                return;
            }
            
            appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
            
            // --- FIN DE LA CONFIGURACIÓN ---

            /* REMOVIDO: Ya no se necesita la config manual
            if (firebaseConfig.apiKey === "TU_API_KEY") {
              const errorMsg = "Error: Debes reemplazar la 'firebaseConfig' con tus propias claves de Firebase (línea 67 aprox.)";
              console.error(errorMsg);
              // Detener la carga si la configuración no se ha cambiado
              document.getElementById('loader').innerHTML = `<div class="p-4 text-center"><div class="text-xl font-semibold text-red-600">${errorMsg}</div></div>`;
              setGlobalError(errorMsg);
              return;
            }
            */

            // Usamos los scripts 'compat' globales, por eso 'firebase.initializeApp'
            const app = firebase.initializeApp(firebaseConfig);
            db = firebase.firestore(app);
            auth = firebase.auth(app);
            
            // Configurar nivel de log de Firestore para depuración
            firebase.firestore.setLogLevel('debug');

            auth.onAuthStateChanged(async (user) => {
              if (user) {
                console.log("Usuario autenticado:", user.uid);
                // Usamos la ruta de artefactos públicos
                collectionPath = `artifacts/${appId}/public/data/contacts`; 
                setUserId(user.uid);
                setAuthReady(true);
              } else {
                // Autenticar usando el token global o anónimamente como fallback
                try {
                    if (typeof __initial_auth_token !== 'undefined') {
                        console.log("Autenticando con token personalizado...");
                        await auth.signInWithCustomToken(__initial_auth_token);
                    } else {
                        console.log("Autenticando anónimamente...");
                        await auth.signInAnonymously();
                    }
                } catch (authError) {
                     console.error("Error en la autenticación:", authError);
                     const errorMsg = `Error de autenticación: ${authError.message}`;
                     document.getElementById('loader').innerHTML = `<div class="p-4 text-center"><div class="text-xl font-semibold text-red-600">${errorMsg}</div></div>`;
                     setGlobalError(errorMsg);
                }
              }
            });

          } catch (error) {
            console.error("Error al inicializar Firebase:", error);
            const errorMsg = `Error al inicializar Firebase. Revisa la consola (F12). ${error.message}`;
            document.getElementById('loader').innerHTML = `<div class="p-4 text-center"><div class="text-xl font-semibold text-red-600">${errorMsg}</div></div>`;
            setGlobalError(errorMsg);
          }
        };

        /**
         * Icono SVG de Carga
         */
        function LoadingSpinner() {
          return (
            <svg className="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
              <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
              <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
          );
        }

        /**
         * Procesador de Texto Copiado
         */
        function TextCaptureForm({ globalError }) {
          const [textData, setTextData] = useState('');
          const [loading, setLoading] = useState(false);
          const [error, setError] = useState('');
          const [status, setStatus] = useState('');

          // --- Configuración de la API de IA (Gemini) ---
          // ¡¡IMPORTANTE!! Esta clave de API también debe ser tuya.
          // 1. Ve a https://aistudio.google.com/app/apikey
          // 2. Crea una clave de API y pégala aquí.
          const apiKey = "PEGA_TU_API_KEY_DE_GEMINI_AQUI"; 
          const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;

          const systemPrompt = `
            Eres un asistente de extracción de datos de alta precisión.
            Tu tarea es encontrar el SITIO WEB OFICIAL y el CORREO ELECTRÓNICO DE CONTACTO
            para la empresa específica que te proporciona el usuario.
            Debes usar la herramienta de Google Search.
            Prioriza correos de contacto genéricos (ej. info@, contacto@, ventas@, contactenos@).
            No inventes información. Si no encuentras un email o web, devuelve un string vacío "".
            Responde ÚNICAMENTE con el formato JSON solicitado.
          `;

          const jsonSchema = {
            type: "OBJECT",
            properties: {
              "nombre": { "type": "STRING" },
              "email": { "type": "STRING" },
              "web": { "type": "STRING" }
            },
            required: ["nombre", "email", "web"]
          };

          /**
           * Llama a la API de Gemini para UNA SOLA empresa
           */
          const getContactForCompany = async (companyName) => {
            if (apiKey === "PEGA_TU_API_KEY_DE_GEMINI_AQUI") {
              throw new Error("Configura tu API Key de Gemini en el código (línea 189 aprox.)");
            }
            const userQuery = `Encuentra el sitio web oficial y el correo de contacto para la empresa: "${companyName}"`;

            const payload = {
              contents: [{ parts: [{ text: userQuery }] }],
              systemInstruction: { parts: [{ text: systemPrompt }] },
              tools: [{ "google_search": {} }],
              generationConfig: {
                responseMimeType: "application/json",
                responseSchema: jsonSchema
              }
            };

            let response;
            // Implementar reintento simple con backoff exponencial
            for (let i = 0; i < 3; i++) { 
              response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
              });
              if (response.ok) break; // Éxito, salir del bucle
              // Reintentar en 429 (Too Many Requests) o 5xx (Server Error)
              if (response.status === 429 || response.status >= 500) {
                const delay = 1000 * (2 ** i); // 1s, 2s, 4s
                console.warn(`API Rate Limit o error de servidor. Reintentando en ${delay}ms...`);
                await new Promise(res => setTimeout(res, delay));
              } else {
                // Otro tipo de error (ej. 400 Bad Request), no reintentar
                break;
              }
            }
            
            if (!response.ok) {
              const errorBody = await response.text();
              console.error("Error API:", errorBody);
              throw new Error(`Error en la API de IA (${response.status}): ${response.statusText}`);
            }
            const result = await response.json();
            
            if (result.candidates?.[0]?.content?.parts?.[0]?.text) {
              const jsonText = result.candidates[0].content.parts[0].text;
              const data = JSON.parse(jsonText);
              data.nombre = companyName; // Asegurarse que el nombre original se mantenga
              return data;
            } else {
              console.warn("Respuesta de la IA no tuvo contenido:", result);
              return { nombre: companyName, email: "", web: "" };
            }
          };
          
          /**
           * Guarda el contacto enriquecido en Firestore
           */
          const saveContactToFirestore = async (contact) => {
            try {
              // Usamos la sintaxis 'compat' global
              await db.collection(collectionPath).add({
                nombre: contact.nombre,
                email: contact.email || '',
                web: contact.web || '',
                fuente: 'Captura Web IA',
                supervisor: contact.supervisor || '',
                // Usamos la sintaxis 'compat' global
                capturadoEn: firebase.firestore.Timestamp.now()
              });
            } catch (err) {
              console.error("Error guardando contacto individual:", err);
            }
          };

          /**
           * Manejador del envío del formulario
           */
          const handleSubmit = async (e) => {
            e.preventDefault();
            if (globalError) {
              setError(`Error de configuración: ${globalError}`);
              return;
            }
            if (apiKey === "PEGA_TU_API_KEY_DE_GEMINI_AQUI") {
                setError("Error: Configura tu API Key de Gemini en el código (línea 189 aprox.)");
                return;
            }
            if (!textData) {
              setError('Por favor, pega tus datos en el área de texto.');
              return;
            }
            if (typeof window.Papa === 'undefined') {
              setError('La librería de parseo (Papa Parse) no se ha cargado. Refresca la página.');
              return;
            }
            
            setLoading(true);
            setError('');
            setStatus('Iniciando procesamiento del texto...');

            // Usar Papa Parse (cargado globalmente)
            window.Papa.parse(textData, {
              header: true,
              delimiter: ",", // Separador por Coma (CSV)
              skipEmptyLines: true,
              complete: async (results) => {
                const companies = results.data;
                if (!companies || companies.length === 0 || !results.meta.fields.includes("RAZÓN SOCIAL")) {
                  setError('No se encontraron datos válidos. Revisa el formato (CSV - coma) y asegúrate que exista la cabecera "RAZÓN SOCIAL".');
                  setLoading(false);
                  return;
                }
                
                setStatus(`Texto leído. Se encontraron ${companies.length} empresas. Empezando captura...`);
                let processedCount = 0;
                
                for (const company of companies) {
                  const companyName = company["RAZÓN SOCIAL"];
                  const supervisor = company["SUPERVISOR"]; // Opcional
                  
                  if (!companyName || companyName.trim() === '') {
                    console.warn("Fila omitida, 'RAZÓN SOCIAL' está vacía:", company);
                    continue;
                  }

                  processedCount++;
                  setStatus(`[${processedCount}/${companies.length}] Buscando: "${companyName}"...`);
                  
                  try {
                    const contactData = await getContactForCompany(companyName);
                    contactData.supervisor = supervisor; // Añadir el supervisor
                    
                    if (contactData.email || contactData.web) {
                      setStatus(`[${processedCount}/${companies.length}] Encontrado: "${companyName}". Guardando...`);
                    } else {
                      setStatus(`[${processedCount}/${companies.length}] No se encontró info para: "${companyName}". Guardando solo nombre.`);
                    }
                    await saveContactToFirestore(contactData);
                    
                    // Pausa breve para no saturar la API de IA
                    await new Promise(res => setTimeout(res, 500)); 

                  } catch (err) {
                    console.error(`Error procesando ${companyName}:`, err);
                    setError(`Error en ${companyName}: ${err.message}`);
                    // Pausa más larga si hay un error (ej. rate limit)
                    await new Promise(res => setTimeout(res, 2000));
                  }
                }
                
                setStatus(`Proceso completado. Se procesaron ${processedCount} empresas.`);
                setLoading(false);
                setTextData(''); // Limpiar el formulario
              },
              error: (err) => {
                setError(`Error al leer el texto: ${err.message}. Asegúrate que esté separado por coma (CSV).`);
                setLoading(false);
              }
            });
          };

          return (
            <div className="bg-white p-6 rounded-lg shadow-md mb-8">
              <h2 className="text-2xl font-semibold mb-4 text-gray-800">Enriquecedor por Lote de Texto</h2>
              <p className="text-gray-600 mb-4">
                Pega tu lista de empresas (con cabeceras `RAZÓN SOCIAL` y `SUPERVISOR`, separadas por coma (CSV)).
                El sistema buscará el `WEB` y `CORREO ELECTRONICO` para cada una.
              </p>
              <form onSubmit={handleSubmit} className="space-y-4">
                <div>
                  <label htmlFor="textData" className="block text-sm font-medium text-gray-700">Pega tus datos (formato CSV) aquí</label>
                  <textarea
                    id="textData"
                    rows="10"
                    value={textData}
                    onChange={(e) => setTextData(e.target.value)}
                    placeholder={
`WEB,CORREO ELECTRONICO,EVALUACIÓN,Escriba OBSERVACIONES TEXTO,RAZÓN SOCIAL,SUPERVISOR
,,,,ESTYMA ESTUDIOS Y MANEJOS SA,SUPERSOCIEDADES
,,,,Empaquetaduras y Empaques S.A.,SUPERSOCIEDADES
...`
                    }
                    className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm font-mono"
                  />
                </div>
                <button
                  type="submit"
                  disabled={loading || !textData || !!globalError}
                  className="w-full flex justify-center items-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:bg-gray-400 disabled:cursor-not-allowed"
                >
                  {loading && <LoadingSpinner />}
                  {loading ? 'Procesando Lote...' : 'Iniciar Enriquecimiento'}
                </button>
                {status && <p className="text-blue-600 text-sm mt-2 font-medium">{status}</p>}
                {error && <p className="text-red-500 text-sm mt-2">{error}</p>}
                {globalError && !error && <p className="text-red-600 text-sm font-semibold mt-2">Error de Configuración de Firebase: La plataforma no puede conectarse a la base de datos.</p>}
              </form>
            </div>
          );
        }

        /**
         * Componente principal de la aplicación
         */
        function App() {
          const [userId, setUserId] = useState(null);
          const [isAuthReady, setAuthReady] = useState(false);
          const [globalError, setGlobalError] = useState(null);
          const [contacts, setContacts] = useState([]);
          const [loadingDB, setLoadingDB] = useState(true);
          const [searchTerm, setSearchTerm] = useState('');

          // 1. Configurar Firebase al cargar
          useEffect(() => {
            setupFirebase(setUserId, setAuthReady, setGlobalError);
          }, []);

          // 2. Escuchar la base de datos cuando la autenticación esté lista
          useEffect(() => {
            if (!isAuthReady || !db || !userId || globalError) {
              // Si hay un error global, no intentar cargar la DB
              if(globalError) setLoadingDB(false);
              return;
            }

            setLoadingDB(true);
            
            // Usamos la sintaxis 'compat' global
            const q = db.collection(collectionPath);
            
            const unsubscribe = q.onSnapshot((querySnapshot) => {
              const contactsData = [];
              querySnapshot.forEach((doc) => {
                const data = doc.data();
                contactsData.push({
                  id: doc.id,
                  ...data,
                  // Convertir Timestamp de Firebase a Date
                  capturadoEn: data.capturadoEn ? data.capturadoEn.toDate() : new Date() 
                });
              });
              // Ordenar por fecha, más nuevos primero
              contactsData.sort((a, b) => b.capturadoEn - a.capturadoEn);
              setContacts(contactsData);
              setLoadingDB(false);
            }, (error) => {
              console.error("Error al escuchar la colección: ", error);
              setGlobalError("Error al leer la base de datos. ¿Configuraste las reglas de Firestore?");
              setLoadingDB(false);
            });

            // Limpiar el listener al desmontar
            return () => unsubscribe();
          }, [isAuthReady, userId, globalError]); // Depender de estas variables

          // 3. Filtrar contactos para la búsqueda (memoizado)
          const filteredContacts = useMemo(() => {
            const term = searchTerm.toLowerCase();
            if (!term) return contacts;
            
            return contacts.filter(contact =>
              (contact.email && contact.email.toLowerCase().includes(term)) ||
              (contact.nombre && contact.nombre.toLowerCase().includes(term)) ||
              (contact.web && contact.web.toLowerCase().includes(term)) ||
              (contact.supervisor && contact.supervisor.toLowerCase().includes(term))
            );
          }, [contacts, searchTerm]);

          // 4. Función para exportar a CSV
          const exportToCSV = () => {
            let csvContent = "data:text/csv;charset=utf-8,Nombre (Razón Social),Supervisor,Email (Encontrado),Sitio Web (Encontrado),Fuente,Fecha de Captura\n";

            filteredContacts.forEach(item => {
              const row = [
                `"${item.nombre || ''}"`,
                `"${item.supervisor || ''}"`,
                `"${item.email || ''}"`,
                `"${item.web || ''}"`,
                `"${item.fuente || ''}"`,
                `"${item.capturadoEn.toLocaleString('es-ES')}"`
              ].join(",");
              csvContent += row + "\n";
            });

            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", `base_datos_enriquecida_${new Date().toISOString().split('T')[0]}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
          };

          // 5. Función de ayuda para formatear URLs
          const formatWebUrl = (url) => {
            if (!url) return null;
            if (url.startsWith('http://') || url.startsWith('https://')) {
              return url;
            }
            // Asumir https y limpiar 'www.' que a veces se duplica
            return `https://${url.replace(/^www\./i, '')}`;
          }

          // No renderizar nada hasta que la autenticación esté lista
          // (el loader global #loader se encarga)
          if (!isAuthReady && !globalError) {
            return null;
          }
          
          // Si la autenticación falló (configuración mala), solo mostrar el error
          if (globalError && !isAuthReady) {
             return (
               <div className="min-h-screen bg-gray-100 p-4 sm:p-8">
                 <div className="max-w-7xl mx-auto">
                   <header className="mb-6 bg-white p-6 rounded-lg shadow-md border-l-4 border-red-500">
                     <h1 className="text-3xl font-bold text-gray-900">Plataforma de Enriquecimiento de Datos</h1>
                     <p className="text-lg text-red-700 mt-2 font-semibold">{globalError}</p>
                     <p className="text-gray-600 mt-1">Por favor, revisa la consola (F12) para más detalles.</p>
                   </header>
                 </div>
               </div>
             );
          }

          // Renderizado principal
          return (
            <div className="min-h-screen bg-gray-100 p-4 sm:p-8">
              <div className="max-w-7xl mx-auto">
                <header className="mb-6">
                  <h1 className="text-3xl font-bold text-gray-900">Plataforma de Enriquecimiento de Datos</h1>
                  <p className="text-xs text-gray-500 mt-1">ID de sesión: {userId}</p>
                  {globalError && (
                    <div className="mt-4 bg-red-100 border-l-4 border-red-500 text-red-700 p-4 rounded-md">
                      <p className="font-bold">Error</p>
                      <p>{globalError}</p>
                    </div>
                  )}
                </header>
                
                <TextCaptureForm globalError={globalError} />

                <div className="bg-white p-6 rounded-lg shadow-md">
                  <h2 className="text-2xl font-semibold mb-4 text-gray-800">Base de Datos en Tiempo Real</h2>
                  
                  <div className="flex flex-col sm:flex-row justify-between gap-4 mb-4">
                    <input
                      type="text"
                      placeholder="Buscar por nombre, supervisor, correo o web..."
                      value={searchTerm}
                      onChange={(e) => setSearchTerm(e.target.value)}
                      className="w-full sm:w-96 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                    />
                    
                    <button
                      onClick={exportToCSV}
                      disabled={filteredContacts.length === 0}
                      className="w-full sm:w-auto flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:bg-gray-400 disabled:cursor-not-allowed"
                    >
                      Descargar (.csv)
                    </button>
                  </div>

                  <div className="overflow-x-auto rounded-lg border border-gray-200">
                    <table className="min-w-full divide-y divide-gray-200">
                      <thead className="bg-gray-50">
                        <tr>
                          <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nombre (Razón Social)</th>
                          <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Supervisor</th>
                          <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Email (Encontrado)</th>
                          <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Sitio Web (Encontrado)</th>
                          <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Fecha de Captura</th>
                        </tr>
                      </thead>
                      <tbody className="bg-white divide-y divide-gray-200">
                        {loadingDB && (
                          <tr>
                            <td colSpan="5" className="px-6 py-4 text-center text-gray-500">Cargando base de datos...</td>
                          </tr>
                        )}
                        {!loadingDB && contacts.length === 0 && !globalError && (
                          <tr>
                            <td colSpan="5" className="px-6 py-4 text-center text-gray-500">
                              {searchTerm ? 'No hay resultados para tu búsqueda.' : 'Pega tus datos en el formulario de arriba para comenzar.'}
                            </td>
                          </tr>
                        )}
                         {!loadingDB && filteredContacts.length === 0 && contacts.length > 0 && (
                          <tr>
                            <td colSpan="5" className="px-6 py-4 text-center text-gray-500">
                              No hay resultados para tu búsqueda: "{searchTerm}"
                            </td>
                          </tr>
                        )}
                        {!loadingDB && filteredContacts.map((contact) => {
                          const webUrl = formatWebUrl(contact.web);
                          return (
                            <tr key={contact.id} className="hover:bg-gray-50">
                              <td className="px-6 py-4 whitespace-nowJrap text-sm font-medium text-gray-900">{contact.nombre || '-'}</td>
                              <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{contact.supervisor || '-'}</td>
                              <td className="px-6 py-4 whitespace-nowrap text-sm text-blue-600">
                                {contact.email ? <a href={`mailto:${contact.email}`} className="hover:underline">{contact.email}</a> : <span className="text-gray-400">-</span>}
                              </td>
                              <td className="px-6 py-4 whitespace-nowrap text-sm text-blue-600">
                                {webUrl ? <a href={webUrl} target="_blank" rel="noopener noreferrer" className="hover:underline">{contact.web}</a> : <span className="text-gray-400">-</span>}
                              </td>
                              <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{contact.capturadoEn.toLocaleString('es-ES', { day: '2-digit', month: '2-digit', year: 'numeric', hour: '2-digit', minute: '2-digit' })}</td>
                            </tr>
                          );
                        })}
                      </tbody>
                    </table>
                  </div>
                  {filteredContacts.length > 0 && (
                    <p className="text-sm text-gray-600 mt-4">
                      Mostrando {filteredContacts.length} de {contacts.length} registros totales.
                    </p>
                  )}
                </div>
              </div>
            </div>
          );
        }

        // 6. Renderizar la aplicación React en el DOM
        ReactDOM.render(
          React.createElement(App),
          document.getElementById('root')
        );

    </script>
</body>
</html>

